{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Joseph/Projects/PICABORD_Web/app/api/cms/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { cookies } from 'next/headers';\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\nimport { randomUUID } from 'crypto';\r\n\r\nasync function checkAuth() {\r\n  const cookieStore = await cookies();\r\n  const session = cookieStore.get('cms-session');\r\n  return session?.value === 'authenticated';\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  const isAuth = await checkAuth();\r\n\r\n  if (!isAuth) {\r\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n  }\r\n\r\n  try {\r\n    const formData = await request.formData();\r\n    const file = formData.get('file') as File;\r\n\r\n    if (!file) {\r\n      return NextResponse.json({ error: 'No file provided' }, { status: 400 });\r\n    }\r\n\r\n    // Validate file type\r\n    const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];\r\n    if (!validTypes.includes(file.type)) {\r\n      return NextResponse.json({ error: 'Invalid file type. Only JPEG, PNG, GIF, and WebP are allowed.' }, { status: 400 });\r\n    }\r\n\r\n    // Validate file size (max 5MB)\r\n    const maxSize = 5 * 1024 * 1024; // 5MB\r\n    if (file.size > maxSize) {\r\n      return NextResponse.json({ error: 'File too large. Maximum size is 5MB.' }, { status: 400 });\r\n    }\r\n\r\n    // Create upload directory if it doesn't exist\r\n    const uploadDir = path.join(process.cwd(), 'public', 'blog', 'uploads');\r\n    if (!fs.existsSync(uploadDir)) {\r\n      await fs.promises.mkdir(uploadDir, { recursive: true });\r\n    }\r\n\r\n    // Generate unique filename\r\n    const ext = path.extname(file.name);\r\n    const uniqueFilename = `${randomUUID()}${ext}`;\r\n    const filePath = path.join(uploadDir, uniqueFilename);\r\n\r\n    // Convert File to Buffer and save\r\n    const bytes = await file.arrayBuffer();\r\n    const buffer = Buffer.from(bytes);\r\n    await fs.promises.writeFile(filePath, buffer);\r\n\r\n    // Return public URL\r\n    const publicUrl = `/blog/uploads/${uniqueFilename}`;\r\n    \r\n    return NextResponse.json({ \r\n      success: true, \r\n      url: publicUrl,\r\n      filename: uniqueFilename,\r\n      message: 'Image uploaded successfully' \r\n    });\r\n  } catch (error) {\r\n    console.error('Upload error:', error);\r\n    return NextResponse.json({ error: 'Failed to upload image' }, { status: 500 });\r\n  }\r\n}\r\n\r\n// Get list of uploaded images\r\nexport async function GET(request: NextRequest) {\r\n  const isAuth = await checkAuth();\r\n\r\n  if (!isAuth) {\r\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n  }\r\n\r\n  try {\r\n    const uploadDir = path.join(process.cwd(), 'public', 'blog', 'uploads');\r\n    \r\n    if (!fs.existsSync(uploadDir)) {\r\n      return NextResponse.json({ images: [] });\r\n    }\r\n\r\n    const files = await fs.promises.readdir(uploadDir);\r\n    const images = files\r\n      .filter(file => /\\.(jpg|jpeg|png|gif|webp)$/i.test(file))\r\n      .map(file => ({\r\n        filename: file,\r\n        url: `/blog/uploads/${file}`,\r\n      }));\r\n\r\n    return NextResponse.json({ images });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'Failed to fetch images' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}