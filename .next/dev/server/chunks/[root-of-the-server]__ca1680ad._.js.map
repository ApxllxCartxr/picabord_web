{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Joseph/Projects/PICABORD_Web/app/api/cms/posts/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { cookies } from 'next/headers';\r\nimport * as fs from 'fs';\r\nimport * as path from 'path';\r\nimport { randomUUID } from 'crypto';\r\n\r\nconst BLOG_DIR = path.join(process.cwd(), 'content', 'blog');\r\n\r\nasync function checkAuth() {\r\n  const cookieStore = await cookies();\r\n  const session = cookieStore.get('cms-session');\r\n  return session?.value === 'authenticated';\r\n}\r\n\r\nasync function getAllPosts() {\r\n  if (!fs.existsSync(BLOG_DIR)) {\r\n    await fs.promises.mkdir(BLOG_DIR, { recursive: true });\r\n  }\r\n\r\n  const files = await fs.promises.readdir(BLOG_DIR);\r\n  const mdxFiles = files.filter(f => f.endsWith('.mdx'));\r\n\r\n  const posts = await Promise.all(\r\n    mdxFiles.map(async (file) => {\r\n      const content = await fs.promises.readFile(path.join(BLOG_DIR, file), 'utf-8');\r\n      const id = file.replace('.mdx', '');\r\n\r\n      // Extract frontmatter\r\n      const frontmatterMatch = content.match(/^---\\n([\\s\\S]*?)\\n---/);\r\n      if (frontmatterMatch) {\r\n        const frontmatter: any = {};\r\n        frontmatterMatch[1].split('\\n').forEach(line => {\r\n          const [key, ...valueParts] = line.split(':');\r\n          if (key && valueParts.length) {\r\n            const value = valueParts.join(':').trim().replace(/^[\"']|[\"']$/g, '');\r\n            frontmatter[key.trim()] = value;\r\n          }\r\n        });\r\n\r\n        return {\r\n          id,\r\n          slug: frontmatter.slug || id,\r\n          ...frontmatter,\r\n          content: content.replace(frontmatterMatch[0], '').trim()\r\n        };\r\n      }\r\n\r\n      return { id, slug: id, content };\r\n    })\r\n  );\r\n\r\n  return posts.sort((a: any, b: any) => new Date(b.date).getTime() - new Date(a.date).getTime());\r\n}\r\n\r\nfunction generateSlug(title: string) {\r\n  return title\r\n    .toLowerCase()\r\n    .replace(/[^a-z0-9]+/g, '-')\r\n    .replace(/(^-|-$)/g, '');\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  const isAuth = await checkAuth();\r\n\r\n  if (!isAuth) {\r\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n  }\r\n\r\n  try {\r\n    const posts = await getAllPosts();\r\n    return NextResponse.json(posts);\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'Failed to fetch posts' }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  const isAuth = await checkAuth();\r\n\r\n  if (!isAuth) {\r\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\r\n  }\r\n\r\n  try {\r\n    const { title, excerpt, category, tags, image, content } = await request.json();\r\n\r\n    if (!title || !content) {\r\n      return NextResponse.json({ error: 'Title and content are required' }, { status: 400 });\r\n    }\r\n\r\n    const id = randomUUID();\r\n    const slug = generateSlug(title);\r\n    const date = new Date().toISOString().split('T')[0];\r\n\r\n    const frontmatter = `---\r\nid: \"${id}\"\r\nslug: \"${slug}\"\r\ntitle: \"${title}\"\r\ndate: \"${date}\"\r\nexcerpt: \"${excerpt || ''}\"\r\ncategory: \"${category || 'Software'}\"\r\ntags: ${tags || '[]'}${image ? `\\nimage: \"${image}\"` : ''}\r\nauthor: \"PICABORD Team\"\r\npublished: true\r\n---\r\n\r\n${content}`;\r\n\r\n    const filePath = path.join(BLOG_DIR, `${id}.mdx`);\r\n    await fs.promises.writeFile(filePath, frontmatter);\r\n\r\n    return NextResponse.json({ success: true, id, slug, message: 'Post created successfully' });\r\n  } catch (error) {\r\n    return NextResponse.json({ error: 'Failed to create post' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}